<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Street Food Connect - Register</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#4F46E5',
            secondary: '#10B981',
            dark: '#1F2937',
            light: '#F9FAFB',
          },
          fontFamily: {
            sans: ['Poppins', 'sans-serif'],
          },
        }
      },
      darkMode: 'class',
    }
  </script>
  <style>
    .language-toggle input[type="checkbox"] {
      height: 0;
      width: 0;
      visibility: hidden;
    }
    .language-toggle label {
      cursor: pointer;
      text-indent: -9999px;
      width: 80px;
      height: 40px;
      background: #4F46E5;
      display: block;
      border-radius: 20px;
      position: relative;
    }
    .language-toggle label:after {
      content: 'EN HI';
      display: block;
      position: absolute;
      top: 5px;
      left: 5px;
      width: 30px;
      height: 30px;
      background: #fff;
      border-radius: 15px;
      transition: 0.3s;
      text-indent: 0;
      color: #4F46E5;
      font-weight: bold;
      font-size: 12px;
      line-height: 30px;
      text-align: center;
    }
    .language-toggle input:checked + label {
      background: #10B981;
    }
    .language-toggle input:checked + label:after {
      left: calc(100% - 5px);
      transform: translateX(-100%);
      content: 'HI EN';
    }

    .error-message {
      background-color: #EF4444;
      color: white;
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 1rem;
      display: none;
    }
  </style>
</head>
<body class="font-sans bg-gray-50 min-h-screen">
  <div class="flex flex-col items-center justify-center min-h-screen p-4 bg-gradient-to-br from-primary to-secondary">
    <div class="w-full max-w-2xl bg-white rounded-xl shadow-lg overflow-hidden">
      <div class="flex justify-between items-center p-6 bg-gray-100">
        <h1 class="text-2xl font-bold text-dark">Street Food Connect</h1>
        <div class="language-toggle">
          <input type="checkbox" id="language-switch" onchange="toggleLanguage()" />
          <label for="language-switch">Toggle</label>
        </div>
      </div>

      <div class="p-6">
        <div id="error-message" class="error-message">
          <p class="lang-en"></p>
          <p class="lang-hi hidden"></p>
        </div>

        <h2 class="text-xl font-semibold mb-6 text-center text-dark lang-en">Register as <span id="role-text">Vendor</span></h2>
        <h2 class="text-xl font-semibold mb-6 text-center text-dark lang-hi hidden">पंजीकरण करें</h2>

        <form id="register-form" class="space-y-4">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1 lang-en">Full Name</label>
              <label class="block text-sm font-medium text-gray-700 mb-1 lang-hi hidden">पूरा नाम</label>
              <input type="text" id="full-name" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" required>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1 lang-en">Email Address</label>
              <label class="block text-sm font-medium text-gray-700 mb-1 lang-hi hidden">ईमेल पता</label>
              <input type="email" id="email" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" required>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1 lang-en">Password</label>
              <label class="block text-sm font-medium text-gray-700 mb-1 lang-hi hidden">पासवर्ड</label>
              <input type="password" id="password" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" required>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1 lang-en">Confirm Password</label>
              <label class="block text-sm font-medium text-gray-700 mb-1 lang-hi hidden">पासवर्ड की पुष्टि कीजिये</label>
              <input type="password" id="confirm-password" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" required>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1 lang-en">Phone Number</label>
              <label class="block text-sm font-medium text-gray-700 mb-1 lang-hi hidden">फ़ोन नंबर</label>
              <input type="tel" id="phone" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" required>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1 lang-en">Address</label>
              <label class="block text-sm font-medium text-gray-700 mb-1 lang-hi hidden">पता</label>
              <input type="text" id="address" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" required>
            </div>
          </div>

          <div class="flex justify-end space-x-4 mt-6">
            <a href="/" class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition duration-200 lang-en">Cancel</a>
            <a href="/" class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition duration-200 lang-hi hidden">रद्द करें</a>
            
            <button type="submit" class="px-6 py-2 bg-primary hover:bg-indigo-700 text-white rounded-lg transition duration-200 lang-en">Register</button>
            <button type="submit" class="px-6 py-2 bg-primary hover:bg-indigo-700 text-white rounded-lg transition duration-200 lang-hi hidden">पंजीकरण करें</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script>
    // Get user type from URL
    const urlParams = new URLSearchParams(window.location.search);
    const userType = urlParams.get('type') || 'vendor';
    document.getElementById('role-text').textContent = userType.charAt(0).toUpperCase() + userType.slice(1);

    // Language toggle functionality
    function toggleLanguage() {
      const isHindi = document.getElementById('language-switch').checked;
      localStorage.setItem('language', isHindi ? 'hi' : 'en');
      
      document.querySelectorAll('.lang-en').forEach(el => el.classList.toggle('hidden', isHindi));
      document.querySelectorAll('.lang-hi').forEach(el => el.classList.toggle('hidden', !isHindi));
    }

    // Set initial language
    document.addEventListener('DOMContentLoaded', () => {
      const savedLanguage = localStorage.getItem('language');
      if (savedLanguage === 'hi') {
        document.getElementById('language-switch').checked = true;
        toggleLanguage();
      }
    });

    function showError(message) {
      const errorDiv = document.getElementById('error-message');
      errorDiv.style.display = 'block';
      errorDiv.querySelector('.lang-en').textContent = message;
      errorDiv.querySelector('.lang-hi').textContent = getHindiErrorMessage(message);
      setTimeout(() => {
        errorDiv.style.display = 'none';
      }, 5000);
    }

    function getHindiErrorMessage(englishMessage) {
      const messages = {
        'Passwords do not match': 'पासवर्ड मेल नहीं खाते',
        'Email already registered': 'ईमेल पहले से पंजीकृत है',
        'Registration failed': 'पंजीकरण विफल रहा'
      };
      return messages[englishMessage] || 'कुछ गलत हो गया';
    }

    // Handle registration
    document.getElementById('register-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const password = document.getElementById('password').value;
      const confirmPassword = document.getElementById('confirm-password').value;
      
      if (password !== confirmPassword) {
        showError('Passwords do not match');
        return;
      }

      const userData = {
        email: document.getElementById('email').value,
        password: password,
        full_name: document.getElementById('full-name').value,
        phone: document.getElementById('phone').value,
        address: document.getElementById('address').value,
        user_type: userType
      };

      try {
        const response = await fetch('http://localhost:8000/api/v1/auth/register', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(userData)
        });

        const data = await response.json();

        if (!response.ok) {
          throw new Error(data.detail || 'Registration failed');
        }

        // Redirect to login page on successful registration
        window.location.href = '/?registered=true';
      } catch (error) {
        showError(error.message);
      }
    });
  </script>
</body>
</html>
